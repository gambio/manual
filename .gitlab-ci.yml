##
## DEPLOYMENT
##

# Updated new manuel to developers.gambio.de page

stages:
    - deploy


before_script:
    - which python
    - which pip
    - /usr/bin/python3 -m pip install --upgrade pip
    - /usr/bin/python3 -m pip install --upgrade mkdocs
    - /usr/bin/python3 -m pip install --upgrade mkdocs-material
    - /usr/bin/python3 -m pip install --upgrade pymdown-extensions
    - /usr/bin/python3 -m pip install --upgrade markdown-image-caption
    - /usr/bin/python3 -m pip install --upgrade mkdocs-section-index
    - /usr/bin/python3 -m pip install --upgrade mkdocs-toc-sidebar-plugin

build:
    stage: deploy
    environment:
        name: Testing
        url: https://developers.gambio.de/docs/manual/
    script:
        - '# generate manual with mkdocs'
        - export
        - ./src/build.sh ${CI_COMMIT_REF_NAME}
        - rm -r .git # Remove git directory before upload
        - ssh redmine "mkdir -p /var/www/developers.gambio.de/docs/manual/${CI_COMMIT_REF_NAME}/"
        - scp -r ./dist/${CI_COMMIT_REF_NAME}/* redmine:/var/www/developers.gambio.de/docs/manual/${CI_COMMIT_REF_NAME}/
    only:
        - branches
    except:
        - master